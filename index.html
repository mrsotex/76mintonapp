<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>코트 배정 시스템</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- 초기화 확인 모달 -->
    <div id="modal-overlay" onclick="closeModal()">
      <div class="modal" onclick="event.stopPropagation()">
        <div class="modal-icon">⚠️</div>
        <h3>초기화 하시겠습니까?</h3>
        <p>전체 인원 및 코트 배정 정보가<br />모두 삭제됩니다.</p>
        <div class="modal-btns">
          <button class="btn-modal-cancel" onclick="closeModal()">취소</button>
          <button class="btn-modal-confirm" onclick="confirmReset()">초기화</button>
        </div>
      </div>
    </div>

    <div class="header" ondblclick="location.reload()" title="더블클릭: 새로고침">
      <h1>코트 배정 시스템</h1>
      <p>코트당 4명 &nbsp;|&nbsp; A팀 2명 vs B팀 2명</p>
    </div>

    <div class="container">
      <!-- 코트 현황 (항상 표시) -->
      <div class="section" id="sec-courts" style="display: none">
        <h2>
          코트 현황
          <span class="hint-text desktop-hint">코트 제목 더블클릭 → 전원 대기 복귀</span>
          <span class="hint-text touch-hint">제목 0.7초 길게 누르기 → 전원 복귀</span>
        </h2>
        <div class="courts-grid" id="courts-grid"></div>
      </div>

      <!-- 게임준비 -->
      <div class="section" id="sec-ready">
        <h2>
          게임준비
          <span class="hint-text desktop-hint">대기조 헤더 드래그 → 코트에 놓으면 이동 &nbsp;/&nbsp; 더블클릭 → 전원 복귀</span>
          <span class="hint-text touch-hint">헤더 길게 누르기 → 전원 복귀 &nbsp;/&nbsp; 짧게 누르기 → 조 선택 후 코트 탭</span>
          <button class="btn-add-ready" onclick="addReadyGroup()" id="btn-add-ready">+ 대기조 추가</button>
        </h2>
        <div class="courts-grid" id="ready-grid">
          <div class="empty-msg">+ 대기조 추가 버튼으로 게임을 준비하세요.</div>
        </div>
      </div>

      <!-- 전체 인원 현황 -->
      <div class="section">
        <h2>전체 인원 현황</h2>

        <!-- 대기 인원 -->
        <div class="sub-section">
          <div class="sub-header">
            <span class="sub-title available-title">대기 인원</span>
            <span class="sub-count" id="count-pool">0명</span>
            <span class="hint-text desktop-hint"
              >클릭: 선택 → 빈 자리 클릭으로 배정 &nbsp;/&nbsp; 드래그: 배정 &nbsp;/&nbsp; 더블클릭: 삭제</span
            >
            <span class="hint-text touch-hint"
              >탭: 선택 → 빈 자리 탭으로 배정 &nbsp;/&nbsp; 0.7초 길게 누르기: 삭제</span
            >
          </div>
          <div class="people-grid" id="pool-grid">
            <div class="empty-msg">이름을 입력해서 인원을 추가하세요.</div>
          </div>
        </div>

        <div class="section-divider"></div>

        <!-- 코트 배정 인원 -->
        <div class="sub-section">
          <div class="sub-header">
            <span class="sub-title assigned-title">코트 배정 인원</span>
            <span class="sub-count" id="count-assigned">0명</span>
            <span class="hint-text desktop-hint">더블클릭 → 대기로 복귀</span>
            <span class="hint-text touch-hint">0.7초 길게 누르기 → 대기로 복귀</span>
          </div>
          <div class="people-grid" id="assigned-grid">
            <div class="empty-msg">아직 배정된 인원이 없습니다.</div>
          </div>
        </div>
      </div>

      <!-- 설정 패널 -->
      <div class="setup-panel">
        <div class="setup-row">
          <label>코트 수</label>
          <input
            class="court-input"
            id="court-input"
            type="number"
            min="1"
            max="50"
            placeholder="0"
            oninput="onCourtChange()"
          />
          <span class="court-hint">코트당 A팀 2명 vs B팀 2명</span>
          <span class="court-badge" id="court-badge"></span>
        </div>
        <hr class="divider" />
        <div class="setup-row">
          <label>이름 입력</label>
          <input
            class="add-input"
            id="name-input"
            type="text"
            placeholder="이름 입력 후 Enter 또는 추가 버튼"
            maxlength="12"
          />
          <!-- 성별 -->
          <div class="toggle-group">
            <button class="toggle-btn active" id="btn-male" onclick="setGender('남')">남</button>
            <button class="toggle-btn" id="btn-female" onclick="setGender('여')">여</button>
          </div>
          <!-- 급수 -->
          <div class="toggle-group">
            <button class="toggle-btn active" id="btn-lv-A" onclick="setLevel('A')">A</button>
            <button class="toggle-btn" id="btn-lv-B" onclick="setLevel('B')">B</button>
            <button class="toggle-btn" id="btn-lv-C" onclick="setLevel('C')">C</button>
            <button class="toggle-btn" id="btn-lv-D" onclick="setLevel('D')">D</button>
            <button class="toggle-btn" id="btn-lv-E" onclick="setLevel('E')">E</button>
          </div>
          <button class="btn-add" onclick="addPerson()">추가</button>
        </div>
      </div>

      <!-- Stats -->
      <div class="stats">
        <div class="stat-card s-total">
          <div class="num" id="st-total">0</div>
          <div class="lbl">전체 인원</div>
        </div>
        <div class="stat-card s-courts">
          <div class="num" id="st-courts">0 / 0</div>
          <div class="lbl">배정 완료 / 코트 수</div>
        </div>
        <div class="stat-card s-wait">
          <div class="num" id="st-pool">0</div>
          <div class="lbl">대기 인원</div>
        </div>
      </div>

      <!-- Controls -->
      <div class="controls">
        <button class="btn-primary" id="btn-assign" onclick="assignCourts()" disabled>랜덤 배정</button>
        <button class="btn-sample" onclick="generateSampleData()">샘플 데이터 생성</button>
        <button class="btn-fetch" id="btn-fetch" onclick="fetchMembers()">회원 가져오기</button>
        <button class="btn-reset" onclick="resetAll()">초기화</button>
      </div>
    </div>
    <script src="script.js"></script>
  </body>
</html>
